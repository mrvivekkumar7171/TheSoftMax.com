<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Music Player | The SoftMax</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        color: #222;
        padding: 20px;
    }

    h3{
        text-align: center;
    }
    
    #nowPlaying {
        font-weight: bold;
        font-size: 16px;
        color: white;
        margin: 0;
    }

    .container {
        display: flex;
        justify-content: space-around;
        align-items: flex-start;
        flex-wrap: wrap;
        gap: 30px;
    }

    .player, .playlist-section {
        background-color: #252830;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        width: 300px;
        min-height: 200px;
    }

    .player {
        width: 48.5%;
    } 
    .playlist-section {
        width: 35%;
    }

    .player button {
        margin: 10px 5px;
        padding: 5px 10px;
        /* padding: 0 30px;
        margin: 0 10px; */
        background-color: #1581f5;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s ease;
    }

    .player button:hover {
        background-color: #115eb1;
    }

    .playlist button {
        display: block;
        margin: 8px auto;
        margin-left: 8px;
        padding: 12px;
        width: 100%;
        background-color: #252830;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 15px;
        cursor: pointer;
        transition: background-color 0.2s, transform 0.1s;
    }

    .playlist button:hover {
        background-color: #222;
        transform: scale(1.02);
    }

    .player button, .player input[type=range] {
        margin-top: 8px;
    }

    #nowPlaying.playing {
        animation: glow 1.5s infinite alternate;
        color: #1db954;
    }

    @keyframes glow {
        from { text-shadow: 0 0 5px #1db954; }
        to { text-shadow: 0 0 15px #1db954; }
    }

    .equalizer {
        display: flex;
        gap: 4px;
        height: 20px;
        align-items: flex-end;
        visibility: hidden;
    }
    .equalizer div {
        width: 5px;
        background: #1db954;
        animation: equalize 1s infinite ease-in-out;
    }
    .equalizer div:nth-child(1) { animation-delay: 0s; }
    .equalizer div:nth-child(2) { animation-delay: 0.2s; }
    .equalizer div:nth-child(3) { animation-delay: 0.4s; }
    .equalizer div:nth-child(4) { animation-delay: 0.6s; }
    .equalizer div:nth-child(5) { animation-delay: 0.8s; }
    .equalizer div:nth-child(6) { animation-delay: 1s; }

    @keyframes equalize {
        0%, 100% { height: 4px; }
        50% { height: 20px; }
    }

    .now-playing-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        padding: 0 10px;
    }

    .wave-ring {
        /* width: 30px;
        height: 30px;
        border: 2px solid #115eb1; */
        border-radius: 50%;
        margin: auto;
        animation: wave 1.5s infinite ease-in-out;
        visibility: hidden;
    }

    @keyframes wave {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(1.5); opacity: 0; }
    }

    .player button:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }

    body.playing-bg {
        background: linear-gradient(-45deg, #1a1a1a, #222, #1b1f25);
        background-size: 400% 400%;
        animation: bgfade 10s ease infinite;
    }

    @keyframes bgfade {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .volume-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 15px;
        height: 120px;
        justify-content: center;
    }

    .volume-container input[type="range"] {
        transform: rotate(-90deg);
        width: 100px; /* controls the vertical length */
        margin-top: 10px;
    }
    </style>
        <!-- Custom styles -->
        <link rel="stylesheet" href="./assets/css/main.css">
</head>
<!--Keyboard Shortcuts (optional) 
Add Progressive Web App (PWA), a web application that behaves like 
a native app on mobile or desktop. Here's what it means for your music player:-->
<body>

    <div class="container">

        <!-- Left Side: Music Player -->
        <div class="player" >
            <h3>My Music Player</h3>        
            
            <div style="display: flex; align-items: flex-start; width: 100%;">
                <!-- Controller Container: Takes remaining space -->
                <div class="Controller-ocntainer" style="flex: 1; margin-right: 10px;">
                    <div class="now-playing-container">
                        <p id="nowPlaying"></p>
                        <div class="equalizer">
                            <div></div><div></div><div></div><div></div><div></div><div></div>
                        </div>
                    </div>
                    
                    <br>
                    <button onclick="toggleLoop()">üîÅ <span id="loopStatus" style="font-weight: bold; color: white;">Off</span></button>
                    <button onclick="prevSong()">‚èÆÔ∏è</button>
                    <button onclick="pauseSong()">‚è∏Ô∏è</button>
                    <button onclick="playSong()">‚ñ∂Ô∏è</button>
                    <button onclick="stopSong()">‚èπÔ∏è</button>
                    <button onclick="nextSong()">‚è≠Ô∏è</button>
                    <button onclick="toggleShuffle()">üîÄ <span id="shuffleStatus" style="font-weight: bold; color: white;">ON</span></button>
                    
                    <!-- Progress Bar Section -->
                    <div style="margin-top: 20px; display: flex; align-items: center;">
                        <span id="currentTime" style="width: 50px; text-align: right;">0:00</span>
                        <input type="range" id="progressBar" value="0" min="0" step="1" style="width: 80%; flex: 1; margin: 0 10px;">
                        <span id="totalDuration" style="width: 50px; text-align: left;">0:00</span>
                    </div>
                </div>
            
                <!-- Volume Container: Minimum width -->
                <div class="volume-container" style="white-space: nowrap;">
                    <label for="volume"><div class="wave-ring">üîä</div></label><br><br>
                    <input type="range" id="volume" min="0" max="1" step="0.01" value="0.1" onchange="changeVolume(this.value)">
                </div>
            </div>
        </div>

            <!-- Right Side: Playlist -->
        <div class="playlist-section">
            <h3>Playlist</h3>
            <div id="playlistContainer" style="height: 350px; overflow-y: auto;">
                <div class="playlist" id="playlist" style="width: 95%;"></div>
            </div>
            <audio id="audioPlayer" controls style="display:none;" preload="none"></audio>
        </div>
    </div>

    <script>
        const songs = [
            { name: "Aapka Kya Hoga Janabe Ali", file: "./assets/music/ÔºÇAapka Kya Hoga Janabe AliÔºÇ (Dhanno) Housefull Full Song ÔΩú Akshay Kumar ÔΩú Mika Singh_compressed.webm" },
            { name: "Beete Lamhe", file: "./assets/music/ÔºÇBeete LamheÔºÇ Lyrical Video Song  ÔΩú The Train ÔΩú K.K. ÔΩú Mithoon ÔΩú Emraan Hashmi, Geeta Basra_compressed.webm" },
            { name: "Bhare Naina", file: "./assets/music/ÔºÇBhare NainaÔºÇ With Lyrics ÔΩú  Ra One ÔΩú ShahRukh Khan, Kareena Kapoor_compressed.webm" },
            { name: "Deedar De", file: "./assets/music/ÔºÇDeedar De [Full Song]ÔºÇ Hindi Film Dus, Ft Abhishek Bacchan_compressed.webm" },
            { name: "Dil Tu Hi Bataa", file: "./assets/music/ÔºÇDil Tu Hi Bataa Krrish 3ÔºÇ Full Video Song ÔΩú Hrithik Roshan, Kangana Ranaut_compressed.webm" },
            { name: "Panga", file: "./assets/music/ÔºÇDiljit DosanjhÔºÇ ÔΩú Honey Singh ÔΩú Panga Full Song ÔΩú The Next Level ÔΩú New Punjabi Songs_compressed.webm" },
            { name: "Faster Than Lightning", file: "./assets/music/ÔºÇFaster Than LightningÔºÇ feat. Usain Bolt - DJ Steve Porter Remix_compressed.webm" },
            { name: "Hawa Hawa", file: "./assets/music/ÔºÇHawa HawaÔºÇ (Full Video Song) ÔΩú Mubarakan ÔΩú Anil Kapoor, Arjun Kapoor, Ileana D‚ÄôCruz, Athiya Shetty_compressed.webm" },
            { name: "Jiyein Kyun Dum Maaro Dum", file: "./assets/music/ÔºÇJiyein Kyun Dum Maaro DumÔºÇ  Full Video Song (HD) ÔΩú Rana Daggubati, Bipasha Basu_compressed.webm" },
            { name: "Kabhi Jo Badal Barse", file: "./assets/music/ÔºÇKabhi Jo Badal BarseÔºÇ Song Video Jackpot ÔΩú Arijit Singh ÔΩú Sachiin J Joshi, Sunny Leone_compressed.webm" },,
        ];

    const audio = document.getElementById('audioPlayer');
    const volumeSlider = document.getElementById("volume");
    const nowPlaying = document.getElementById('nowPlaying');
    const playlist = document.getElementById('playlist');
    const playlistContainer = document.getElementById('playlistContainer');
    const buttonHeight = 50; // Approx height of one button in px
    const visibleCount = Math.ceil(playlistContainer.clientHeight / buttonHeight) + 5; // Render extra for smooth scroll
    let currentIndex = -1;
    let isLooping = false;
    let isShuffle = true;

    function nextSong() {
        if (isShuffle) {
            currentIndex = Math.floor(Math.random() * songs.length);
        } else {
            currentIndex = (currentIndex + 1) % songs.length;
        }
        loadAndPlay(songs[currentIndex]);
    }

    function prevSong() {
        if (isShuffle) {
            currentIndex = Math.floor(Math.random() * songs.length);
        } else {
            currentIndex = (currentIndex - 1 + songs.length) % songs.length;
        }
        loadAndPlay(songs[currentIndex]);
    }

    function toggleLoop() {
        isLooping = !isLooping;
        audio.loop = isLooping;
        document.getElementById("loopStatus").textContent = isLooping ? "On" : "Off";
    }

    function toggleShuffle() {
        isShuffle = !isShuffle;
        document.getElementById("shuffleStatus").textContent = isShuffle ? "On" : "Off";
    }

    function changeVolume(val) {
        audio.volume = parseFloat(val);
    }

    // Auto play next (or shuffle)
    audio.addEventListener('ended', () => {
        if (!audio.loop) {
            if (isShuffle) {
                currentIndex = Math.floor(Math.random() * songs.length);
                loadAndPlay(songs[currentIndex]);
            } else {
                currentIndex++;
                if (currentIndex < songs.length) {
                    loadAndPlay(songs[currentIndex]);
                } else {
                    nowPlaying.textContent = "Playing: None";
                    currentIndex = -1;
                }
            }
        }
        // Cleanup after end
        // audio.pause();
        // audio.removeAttribute('src');
        // audio.load();  // force browser to unload
    });

    // Generate playlist buttons
    songs.forEach((song, index) => {
        const btn = document.createElement('button');
        btn.textContent = song.name;
        btn.onclick = () => {
        currentIndex = index;
        loadAndPlay(song);
        };
        playlist.appendChild(btn);
    });

    function loadAndPlay(song) {
        // ‚úÖ Clear old audio
        audio.pause();
        audio.removeAttribute('src');
        audio.load();
        
        // ‚úÖ Load new audio
        audio.src = song.file;
        audio.currentTime = 0;
        audio.load();  // force proper loading
        audio.play();
        nowPlaying.textContent = song.name;
    }

    function playSong() {
        if (currentIndex === -1) {
        currentIndex = 0;
        loadAndPlay(songs[currentIndex]);
        } else {
        audio.play();
        }
    }

    function pauseSong() {
        audio.pause();
    }

    function stopSong() {
        audio.pause();
        audio.currentTime = 0;
    }

    // Format time in mm:ss
    function formatTime(seconds) {
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min}:${sec < 10 ? "0" + sec : sec}`;
    }

    const progressBar = document.getElementById('progressBar');
    const currentTimeEl = document.getElementById('currentTime');
    const totalDurationEl = document.getElementById('totalDuration');

    // Update progress bar as audio plays
    audio.addEventListener('timeupdate', () => {
        progressBar.value = audio.currentTime;
        currentTimeEl.textContent = formatTime(audio.currentTime);
    });

    // Set duration once metadata is loaded
    audio.addEventListener('loadedmetadata', () => {
        progressBar.max = Math.floor(audio.duration);
        totalDurationEl.textContent = formatTime(audio.duration);
        audio.volume = 0.1;
        volumeSlider.value = 0.1;
    });

    // Seek when progress bar is changed
    progressBar.addEventListener('input', () => {
        audio.currentTime = progressBar.value;
    });

    audio.addEventListener('play', () => {
        nowPlaying.classList.add('playing');
        document.querySelector('.equalizer').style.visibility = 'visible';
        document.querySelector('.wave-ring').style.visibility = 'visible';
        document.body.classList.add('playing-bg');
    });
    audio.addEventListener('pause', () => {
        nowPlaying.classList.remove('playing');
        document.querySelector('.equalizer').style.visibility = 'hidden';
        document.querySelector('.wave-ring').style.visibility = 'hidden';
        document.body.classList.remove('playing-bg');
    });
    audio.addEventListener('ended', () => {
        nowPlaying.classList.remove('playing');
        document.querySelector('.equalizer').style.visibility = 'hidden';
        document.querySelector('.wave-ring').style.visibility = 'hidden';
        document.body.classList.remove('playing-bg');
    });

    function renderVisibleSongs() {
        const scrollTop = playlistContainer.scrollTop;
        const startIndex = Math.max(0, Math.floor(scrollTop / buttonHeight) - 2);
        const endIndex = Math.min(songs.length, startIndex + visibleCount);

        playlist.innerHTML = "";

        for (let i = startIndex; i < endIndex; i++) {
            const song = songs[i];
            const btn = document.createElement('button');
            btn.textContent = song.name;
            btn.onclick = () => {
                currentIndex = i;
                loadAndPlay(song);
            };
            playlist.appendChild(btn);
        }
    }

    // Add padding for full scroll height
    playlist.style.height = `${songs.length * buttonHeight}px`;

    // Initial render and on scroll
    renderVisibleSongs();
    playlistContainer.addEventListener('scroll', renderVisibleSongs);

    </script>
</body>
</html>
